<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailznic Player</title>
    <style>
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            background: #000; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; color: #fff; font-family: sans-serif;
        }
        .content {
            max-height: 100vh; max-width: 100vw;
            display: none; object-fit: contain;
        }
        #status {
            position: fixed; text-align: center; width: 100%;
            font-size: 18px; color: rgba(255,255,255,0.4);
        }
    </style>
</head>
<body onclick="showNext()">

    <div id="status">Нажмите на меня</div>

    <video id="v" class="content" playsinline></video>
    <img id="i" class="content">

    <script>
        const USER = 'Tailznic';
        const REPO = 'tailznic.github.io';
        const FOLDER = 'media'; 

        let files = [];
        let queue = [];
        const v = document.getElementById('v');
        const i = document.getElementById('i');
        const status = document.getElementById('status');

        async function init() {
            try {
                const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FOLDER}`);
                const data = await res.json();
                if (!Array.isArray(data)) return;

                files = data
                    .filter(f => f.type === 'file')
                    .map(f => f.download_url);
            } catch (err) {
                console.error("Ошибка загрузки:", err);
            }
        }

        function showNext() {
            if (files.length === 0) return;
            status.style.display = 'none';

            if (queue.length === 0) {
                queue = [...files].sort(() => Math.random() - 0.5);
            }

            const url = queue.pop();
            const ext = url.split('.').pop().toLowerCase().split('?')[0];

            v.style.display = i.style.display = 'none';
            v.pause();
            v.src = "";

            // Расширенная поддержка форматов
            const videoExts = ['mp4', 'webm', 'mov', 'ogg'];
            const photoExts = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'avif', 'bmp'];

            if (videoExts.includes(ext)) {
                v.src = url;
                v.style.display = 'block';
                v.muted = false; // ВКЛЮЧАЕМ ЗВУК
                v.play().catch(e => {
                    // Если браузер все еще ругается, запускаем без звука
                    v.muted = false;
                    v.play();
                });
            } else if (photoExts.includes(ext)) {
                i.src = url;
                i.style.display = 'block';
            } else {
                showNext(); // Если попался файл другого типа, просто берем следующий
            }
        }

        v.onended = showNext;
        init();
    </script>
</body>
</html>
