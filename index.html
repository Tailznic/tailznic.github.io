<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Media Viewer</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: #000; overflow: hidden; font-family: sans-serif; color: white; }
        #app { position: relative; width: 100%; height: 100%; display: none; overflow: hidden; }
        
        .container {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.4s cubic-bezier(0.45, 0, 0.55, 1);
        }

        .content { max-height: 100vh; max-width: 100vw; object-fit: contain; }

        /* Анимации сдвига */
        .slide-up { transform: translateY(-100%); }
        .slide-down { transform: translateY(100%); }

        /* Подсказка */
        .hint {
            position: absolute; bottom: 30px; width: 100%; text-align: center;
            color: rgba(255, 255, 255, 0.4); font-size: 12px; 
            text-transform: uppercase; letter-spacing: 2px;
            pointer-events: none; z-index: 10;
        }

        /* Экран подтверждения (Откат дизайна) */
        #age-gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 1000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; padding: 20px;
        }
        #age-gate h1 { color: #fe2c55; font-size: 40px; margin: 0 0 15px 0; }
        #age-gate p { font-size: 16px; margin-bottom: 30px; color: #ccc; line-height: 1.5; }
        #enter-btn { 
            background: #fe2c55; border: none; color: white; padding: 15px 40px; 
            border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="age-gate">
        <h1>18+</h1>
        <p>Контент может содержать ненормативную лексику.<br>Вам есть 18 лет?</p>
        <button id="enter-btn" onclick="verifyAge()">ДА, ВОЙТИ</button>
    </div>

    <div id="app">
        <div id="main-container" class="container">
            <video id="v" class="content" playsinline loop></video>
            <img id="i" class="content">
        </div>
        <div class="hint">Листай вверх, чтобы пропустить</div>
    </div>

    <script>
        const USER = 'Tailznic';
        const REPO = 'tailznic.github.io';
        const FOLDER = 'media';
        let files = [], queue = [];
        let touchStartY = 0;
        let isAnimating = false;

        const container = document.getElementById('main-container');
        const v = document.getElementById('v'), i = document.getElementById('i');

        function verifyAge() {
            document.getElementById('age-gate').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            // Звук разблокируется после этого клика
            init();
        }

        async function init() {
            try {
                const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FOLDER}`);
                const data = await res.json();
                files = data.filter(f => f.type === 'file').map(f => f.download_url);
                queue = [...files].sort(() => Math.random() - 0.5);
                if(queue.length > 0) loadContent(queue.pop());
            } catch (e) { console.error("Ошибка загрузки"); }
        }

        function loadContent(url) {
            if (!url) return;
            const ext = url.split('.').pop().toLowerCase();
            
            v.style.display = i.style.display = 'none';
            v.pause(); v.src = ""; i.src = "";

            if (['mp4', 'webm', 'mov'].includes(ext)) {
                v.src = url; 
                v.style.display = 'block'; 
                v.onloadeddata = () => {
                    // Пробуем включить звук после взаимодействия
                    v.muted = false; 
                    v.play().catch(err => {
                        console.log("Автоплей со звуком заблокирован, включаем без звука");
                        v.muted = true;
                        v.play();
                    });
                    finishTransition();
                };
            } else {
                i.src = url; 
                i.style.display = 'block';
                i.onload = () => finishTransition();
            }
        }

        function triggerSwipe() {
            if (isAnimating) return;
            isAnimating = true;

            container.classList.add('slide-up');

            setTimeout(() => {
                if (queue.length === 0) queue = [...files].sort(() => Math.random() - 0.5);
                container.style.transition = 'none';
                container.classList.remove('slide-up');
                container.classList.add('slide-down');
                loadContent(queue.pop());
            }, 400);
        }

        function finishTransition() {
            setTimeout(() => {
                container.style.transition = 'transform 0.4s cubic-bezier(0.45, 0, 0.55, 1)';
                container.classList.remove('slide-down');
                isAnimating = false;
            }, 50);
        }

        // Запрет паузы
        v.onclick = (e) => e.preventDefault();
        i.onclick = (e) => e.preventDefault();

        // Свайпы
        window.addEventListener('touchstart', e => touchStartY = e.changedTouches[0].screenY);
        window.addEventListener('touchend', e => {
            let touchEndY = e.changedTouches[0].screenY;
            if (Math.abs(touchStartY - touchEndY) > 50) triggerSwipe();
        });

        // Колесо мыши
        window.addEventListener('wheel', e => {
            if (Math.abs(e.deltaY) > 10) triggerSwipe();
        }, { passive: true });
    </script>
</body>
</html>