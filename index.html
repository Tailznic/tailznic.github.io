<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Media Viewer</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        #app { position: relative; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; }
        
        .content { 
            max-height: 100vh; max-width: 100vw; 
            object-fit: contain;
            opacity: 0;
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-out;
            transform: translateY(10px); /* Легкий сдвиг снизу */
        }

        /* Класс для активации анимации */
        .content.active {
            opacity: 1;
            transform: translateY(0);
        }

        #age-gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0a0a0a; z-index: 1000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        #age-gate p { font-size: 14px; margin-bottom: 20px; color: #444; }
        #enter-btn { 
            background: transparent; border: 1px solid #333; color: #666; padding: 8px 20px; 
            border-radius: 4px; font-size: 13px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="age-gate">
        <p>This resource may contain sensitive content. Are you 18 or older?</p>
        <button id="enter-btn" onclick="verifyAge()">Confirm</button>
    </div>

    <div id="app">
        <video id="v" class="content" playsinline loop onclick="togglePlay()"></video>
        <img id="i" class="content" onclick="showNext()">
    </div>

    <script>
        const USER = 'Tailznic';
        const REPO = 'tailznic.github.io';
        const FOLDER = 'media';
        let files = [], queue = [];
        let touchStartY = 0;

        const v = document.getElementById('v'), i = document.getElementById('i');

        function verifyAge() {
            document.getElementById('age-gate').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            init();
        }

        async function init() {
            try {
                const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FOLDER}`);
                const data = await res.json();
                files = data.filter(f => f.type === 'file').map(f => f.download_url);
                queue = [...files].sort(() => Math.random() - 0.5);
                showNext();
            } catch (e) { console.log("error"); }
        }

        function showNext() {
            if (queue.length === 0) {
                queue = [...files].sort(() => Math.random() - 0.5);
            }
            
            const url = queue.pop();
            const ext = url.split('.').pop().toLowerCase();

            // Сбрасываем анимацию (убираем класс active)
            v.classList.remove('active');
            i.classList.remove('active');

            setTimeout(() => {
                v.style.display = i.style.display = 'none';
                v.pause(); v.src = "";

                if (['mp4', 'webm', 'mov'].includes(ext)) {
                    v.src = url; 
                    v.style.display = 'block'; 
                    v.onloadeddata = () => {
                        v.classList.add('active');
                        v.play().catch(() => { v.muted = true; v.play(); });
                    };
                } else {
                    i.src = url; 
                    i.style.display = 'block';
                    i.onload = () => i.classList.add('active');
                }
            }, 100); // Небольшая пауза для чистоты перехода
        }

        function togglePlay() {
            if (v.paused) v.play();
            else v.pause();
        }

        window.addEventListener('touchstart', e => touchStartY = e.changedTouches[0].screenY);
        window.addEventListener('touchend', e => {
            let touchEndY = e.changedTouches[0].screenY;
            if (Math.abs(touchStartY - touchEndY) > 50) showNext();
        });

        window.addEventListener('wheel', e => {
            if (Math.abs(e.deltaY) > 5) showNext();
        });

        v.onended = showNext;
    </script>
</body>
</html>
